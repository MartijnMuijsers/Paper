From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: MartijnMuijsers <martijnmuijsers@live.nl>
Date: Tue, 18 Jan 2022 14:33:49 +0100
Subject: [PATCH] Make keepalive send interval configurable


diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index d8b628268fe3befd03fb9a0180e3a4be57dda056..e4a2f012bf2f01774f7527b616489b3016b700ea 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -100,6 +100,18 @@ public class PaperConfig {
 
     // Martijn end - network-constrained chunk tracking
 
+    // Martijn start - configurable keepalive
+
+    /**
+     * In milliseconds
+     */
+    public static int keepaliveSendInterval = 5000; // 5 seconds
+    private static void keepaliveSendInterval() {
+        keepaliveSendInterval = getInt("keepalive.send-interval", keepaliveSendInterval);
+    }
+
+    // Martijn end - configurable keepalive
+
     public static boolean logPlayerIpAddresses = true;
     private static void playerIpAddresses() {
         logPlayerIpAddresses = getBoolean("settings.log-player-ip-addresses", logPlayerIpAddresses);
diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 61da0b9bf5a11ab1524e2c65c15ea432f3c69fb4..b823073231f9f8a6b3946a5f3450eb236b000750 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -1,5 +1,6 @@
 package net.minecraft.server.network;
 
+import com.destroystokyo.paper.PaperConfig;
 import com.google.common.collect.Lists;
 import com.google.common.primitives.Floats;
 import com.mojang.brigadier.ParseResults;
@@ -369,7 +370,7 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Ser
 //            }
             // Martijn end - no disconnect on late or wrong keepalive
         } else {
-            if (elapsedTime >= 5000L) { // 5 seconds // Martijn - send keepalive more often
+            if (elapsedTime >= PaperConfig.keepaliveSendInterval) { // Martijn - configurable keepalive
                 this.keepAlivePending = true;
                 this.keepAliveTime = currentTime;
                 this.keepAliveChallenge = currentTime;
