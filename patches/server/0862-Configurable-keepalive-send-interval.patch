From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: MartijnMuijsers <martijnmuijsers@live.nl>
Date: Tue, 18 Jan 2022 14:33:49 +0100
Subject: [PATCH] Configurable keepalive send interval


diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index 61ea1c9881ea30c05580044af9496a65fe95d94e..86471ebda93ab01f3e55e5cb9fa509bf4d17ede1 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -91,6 +91,18 @@ public class PaperConfig {
         }
     }
 
+    // Martijn start - configurable keepalive
+
+    /**
+     * In milliseconds
+     */
+    public static int keepaliveSendInterval = 15000; // 15 seconds
+    private static void keepaliveSendInterval() {
+        keepaliveSendInterval = getInt("keepalive.send-interval", keepaliveSendInterval);
+    }
+
+    // Martijn end - configurable keepalive
+
     public static boolean logPlayerIpAddresses = true;
     private static void playerIpAddresses() {
         logPlayerIpAddresses = getBoolean("settings.log-player-ip-addresses", logPlayerIpAddresses);
diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 5c9310fe424943a7256f6f77c414147384bad0aa..a9e39b3559fdc9fb0dd2f599f85643a27b784b5e 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -1,5 +1,6 @@
 package net.minecraft.server.network;
 
+import com.destroystokyo.paper.PaperConfig;
 import com.google.common.collect.Lists;
 import com.google.common.primitives.Floats;
 import com.mojang.brigadier.ParseResults;
@@ -365,7 +366,7 @@ public class ServerGamePacketListenerImpl implements ServerPlayerConnection, Ser
                 this.disconnect(new TranslatableComponent("disconnect.timeout", new Object[0]), org.bukkit.event.player.PlayerKickEvent.Cause.TIMEOUT); // Paper - kick event cause
             }
         } else {
-            if (elapsedTime >= 15000L) { // 15 seconds
+            if (elapsedTime >= PaperConfig.keepaliveSendInterval) { // Martijn - configurable keepalive
                 this.keepAlivePending = true;
                 this.keepAliveTime = currentTime;
                 this.keepAliveChallenge = currentTime;
